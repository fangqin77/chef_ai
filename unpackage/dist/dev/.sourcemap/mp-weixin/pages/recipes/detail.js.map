{"version":3,"sources":["uni-app:///main.js","webpack:///C:/myprojects/chef_ai/pages/recipes/detail.vue?65fe","webpack:///C:/myprojects/chef_ai/pages/recipes/detail.vue?b5f3","webpack:///C:/myprojects/chef_ai/pages/recipes/detail.vue?6b41","webpack:///C:/myprojects/chef_ai/pages/recipes/detail.vue?dc26","uni-app:///pages/recipes/detail.vue","webpack:///C:/myprojects/chef_ai/pages/recipes/detail.vue?dc63","webpack:///C:/myprojects/chef_ai/pages/recipes/detail.vue?a011"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","fallbackImg","selection","currentIndex","recipe","id","typeId","name","method","condiments","ingredients","feature","imageUrl","favorites","todayPlan","timerPreset","timerSeconds","timerRunning","timerTick","timerStarted","customPresetVisible","customPresetMinutes","datePickerVisible","dateOptions","dateIso","_favKey","computed","steps","isFavorited","isInPlan","timeLeft","progressPct","onLoad","methods","hydrateById","goBack","uni","delta","url","cancelAndBack","applySelection","prevSelection","nextSelection","saveStorage","toggleFavorite","meta","cards","title","icon","togglePlan","selectPreset","startTimer","pauseTimer","clearInterval","resetTimer","applyCustomPreset","planSelectDate","options","isoDates","chooseDate","planned","closeDatePicker","startCook"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,eAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAmH;AACnH;AAC0D;AACL;AACa;;;AAGlE;AAC6L;AAC7L,gBAAgB,uMAAU;AAC1B,EAAE,4EAAM;AACR,EAAE,iFAAM;AACR,EAAE,0FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,qFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACzBA;AAAA;AAAA;AAAA;AAAquB,CAAgB,kvBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eCiGzvB;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACAC;MACAC;MACAC;MAAA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;QAAA;MAAA;MACA;MACA;QAAA;MAAA;IACA;IACAC;MACA;MACA;MACA;IACA;IACAC;MACA;MACA;MACA;IACA;IACAC;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;IACA;EACA;EACAC;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IAEA;IACA;MACA;QACA3B;QACAC;QACAC;QACAC,QACA;QACAC;QACAC;QACAC;QACAC;MACA;IACA;MACA;QACAP;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;IACA;;IAEA;IACA;;IAEA;IACA;MACA;MACA;IACA;MACA;MACA;IACA;;IAEA;IACA;IACA;MACA;IACA;IACA;;IAEA;IACA;MACA;MACA;QACA;QACA;QACA;QACA;UAAA;QAAA;QACA;QACA;QACA;MACA;IACA;EACA;EACAqB;IACA;IACAC;MACA;MACA;MACA;QACA;QACA;QACA;QACA;QACA;MACA;MAEA;QACA;QACA;UACA;YAAA;UAAA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;QACA;MACA;IACA;IACAC;MACA;MACA;QACAC;UAAAC;QAAA;MACA;QACAD;UAAAE;QAAA;UAAAA;QAAA;MACA;IACA;IACAC;MACA;MACA;QACAH;UAAAC;QAAA;MACA;QACAD;UAAAE;QAAA;MACA;IACA;IACA;IACAE;MACA;MACA;MACA;MACA;MACA;QACAnC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;IACA;IACA;IACA6B;MACA;MACA;IACA;IACAC;MACA;MACA;IACA;IACA;IACAC;MACAP;MACAA;IACA;IACAQ;MACA;MACA;MACA;MACA;QAAA;MAAA;MACA;;MAEA;MACA;MACA;MACA;QACAC;QACAC;MACA;QACAD;QACAC;MACA;MAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;UACA;UACAV;QACA;QACAA;QACAA;QACAA;UAAAW;UAAAC;QAAA;QACA;MACA;QACA;QACA;MACA;IACA;IACAC;MACA;MACA;MACA;MACA;QAAA;MAAA;MACA;MACA;QACA;QACAb;UAAAW;UAAAC;QAAA;MACA;QACA;QACAZ;UAAAW;UAAAC;QAAA;MACA;MACA;IACA;IACA;IACAE;MACA;MACA;MACA;MACA;IACA;IACAC;MAAA;MACA;MACA;MACA;MACA;QACA;UACA;QACA;UACA;UACAf;YAAAW;YAAAC;UAAA;QACA;MACA;IACA;IACAI;MACA;MACA;QACAC;QACA;MACA;IACA;IACAC;MACA;MACA;MACA;IACA;IACAC;MACA;MACA;QACAnB;UAAAW;UAAAC;QAAA;QACA;MACA;MACA;MACA;MACA;MACAZ;QAAAW;QAAAC;MAAA;IACA;IACA;IACAQ;MACA;MACA;MACA;MACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,+FACA,+FACA;QACAC;QACAC;MACA;MACA;MACA;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;QACA;MACA;MACA;MACA;QAAAb;MAAA;QAAAA;MAAA;MACAA;QACAzC;QACAE;QACAK;MACA;MACAwB;MACA;MACA;MACA;QAAAwB;MAAA;QAAAA;MAAA;MACAA;MACAxB;MACA;MACA;MACAA;QAAAW;QAAAC;MAAA;IACA;IACA;IACAa;MACA;MACAzB;QAAAW;QAAAC;MAAA;IACA;IACAc;MACA;MACA;QACA;QACA1B;UAAAW;UAAAC;QAAA;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;ACldA;AAAA;AAAA;AAAA;AAA4iC,CAAgB,2hCAAG,EAAC,C;;;;;;;;;;;ACAhkC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/recipes/detail.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/recipes/detail.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./detail.vue?vue&type=template&id=198c1434&\"\nvar renderjs\nimport script from \"./detail.vue?vue&type=script&lang=js&\"\nexport * from \"./detail.vue?vue&type=script&lang=js&\"\nimport style0 from \"./detail.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/recipes/detail.vue\"\nexport default component.exports","export * from \"-!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./detail.vue?vue&type=template&id=198c1434&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.steps.length\n  if (!_vm._isMounted) {\n    _vm.e0 = function ($event) {\n      _vm.customPresetVisible = !_vm.customPresetVisible\n    }\n    _vm.e1 = function ($event) {\n      _vm.timerRunning ? _vm.pauseTimer() : _vm.startTimer()\n    }\n  }\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./detail.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./detail.vue?vue&type=script&lang=js&\"","<template>\r\n  <view class=\"detail-page\">\r\n    <!-- 顶部图 + 渐变遮罩 -->\r\n    <view class=\"hero\">\r\n      <image class=\"hero-img\" :src=\"recipe.imageUrl || fallbackImg\" mode=\"aspectFill\" />\r\n      <view class=\"hero-mask\" />\r\n      <view class=\"hero-title\">\r\n        <text class=\"name\">{{ recipe.name || '菜谱详情' }}</text>\r\n      </view>\r\n      <!-- 收藏星标（右上角） -->\r\n      <view class=\"fav-btn\" @click=\"toggleFavorite\">\r\n        <text class=\"star\">{{ isFavorited ? '★' : '☆' }}</text>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 详情大卡片：原料 / 调料 / 做法 / 基本信息（合并为一个白色方框） -->\r\n    <view class=\"card big-card\">\r\n      <view class=\"section\">\r\n        <view class=\"card-title\">原料</view>\r\n        <view class=\"card-body section-body\">\r\n          <text class=\"para\">{{ recipe.ingredients || '—' }}</text>\r\n        </view>\r\n      </view>\r\n      <view class=\"section\">\r\n        <view class=\"card-title\">调料</view>\r\n        <view class=\"card-body section-body\">\r\n          <text class=\"para\">{{ recipe.condiments || '—' }}</text>\r\n        </view>\r\n      </view>\r\n      <view class=\"section\">\r\n        <view class=\"card-title\">做法</view>\r\n        <view class=\"card-body section-body\">\r\n          <view v-if=\"steps.length\" class=\"steps\">\r\n            <view v-for=\"(s, i) in steps\" :key=\"i\" class=\"step-item\">\r\n              <view class=\"step-index\">{{ i + 1 }}</view>\r\n              <text class=\"step-text\">{{ s }}</text>\r\n            </view>\r\n          </view>\r\n          <text v-else class=\"para\">{{ recipe.method || '—' }}</text>\r\n        </view>\r\n      </view>\r\n      <view class=\"section\">\r\n        <view class=\"card-title\">基本信息</view>\r\n        <view class=\"card-body info-list section-body\">\r\n          <view class=\"info-item\"><text class=\"info-label\">菜谱ID：</text><text class=\"info-value\">{{ recipe.id || '—' }}</text></view>\r\n          <view class=\"info-item\"><text class=\"info-label\">菜谱类型号：</text><text class=\"info-value\">{{ recipe.typeId || '—' }}</text></view>\r\n          <view class=\"info-item\"><text class=\"info-label\">特性：</text><text class=\"info-value\">{{ recipe.feature || '—' }}</text></view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 计时卡片 -->\r\n\r\n\r\n    <view class=\"card timer-card\">\r\n      <view class=\"card-title\">烹饪计时</view>\r\n      <view class=\"card-body\">\r\n        <view class=\"timer-row\">\r\n          <text class=\"time-left\">{{ timeLeft }}</text>\r\n          <view class=\"preset-group\">\r\n            <button class=\"chip-btn\" :class=\"{active: timerPreset===300}\" @click=\"selectPreset(300)\">5分钟</button>\r\n            <button class=\"chip-btn\" :class=\"{active: timerPreset===600}\" @click=\"selectPreset(600)\">10分钟</button>\r\n            <button class=\"chip-btn\" @click=\"customPresetVisible = !customPresetVisible\">自定义</button>\r\n          </view>\r\n          <view v-if=\"customPresetVisible\" class=\"custom-row\">\r\n            <input class=\"custom-input\" type=\"number\" placeholder=\"分钟数\" v-model=\"customPresetMinutes\" />\r\n            <button class=\"chip-btn set-btn\" @click=\"applyCustomPreset\">设定</button>\r\n          </view>\r\n        </view>\r\n        <view class=\"progress\">\r\n          <view class=\"bar\" :style=\"{ width: progressPct + '%', background: (progressPct > 0 ? 'linear-gradient(90deg, #FFE27A 0%, #FFC107 100%)' : 'transparent') }\"></view>\r\n        </view>\r\n        <view class=\"timer-actions\">\r\n          <button class=\"btn ghost small\" @click=\"resetTimer\">重置</button>\r\n          <button class=\"btn primary small\" @click=\"timerRunning ? pauseTimer() : startTimer()\">\r\n            {{ timerRunning ? '暂停' : '开始' }}\r\n          </button>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 日期选择弹层 -->\r\n    <view v-if=\"datePickerVisible\" class=\"overlay\" @touchmove.stop @click=\"closeDatePicker\">\r\n      <view class=\"sheet\" @click.stop>\r\n        <view class=\"sheet-title\">收藏为几日的待做菜谱</view>\r\n        <scroll-view scroll-y class=\"sheet-list\">\r\n          <view v-for=\"(opt, i) in dateOptions\" :key=\"i\" class=\"sheet-item\" @click=\"chooseDate(i)\">{{ opt }}</view>\r\n        </scroll-view>\r\n        <button class=\"btn ghost small\" @click=\"closeDatePicker\">取消</button>\r\n      </view>\r\n    </view>\r\n\r\n    <view style=\"height: 120rpx\" />\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      fallbackImg: '/static/yuan_97e57f821c79b841651df5b413309328.jpg',\r\n      selection: [],\r\n      currentIndex: 0,\r\n      recipe: {\r\n        id: null,\r\n        typeId: null,\r\n        name: '',\r\n        method: '',\r\n        condiments: '',\r\n        ingredients: '',\r\n        feature: '',\r\n        imageUrl: ''\r\n      },\r\n      favorites: [],\r\n      todayPlan: [],\r\n      timerPreset: 0,   // 初始不选预设\r\n      timerSeconds: 0,\r\n      timerRunning: false,\r\n      timerTick: null,\r\n      timerStarted: false,\r\n      customPresetVisible: false,\r\n      customPresetMinutes: '',\r\n      datePickerVisible: false,\r\n      dateOptions: [],\r\n      dateIso: [],\r\n      _favKey: ''\r\n    }\r\n  },\r\n  computed: {\r\n    // 将“(1) … (2) …”或以换行分段的做法拆成步骤\r\n    steps() {\r\n      const m = this.recipe.method || ''\r\n      if (!m) return []\r\n      // 优先匹配形如 (1)(2) 的编号段落\r\n      const numbered = m.split(/\\(\\d+\\)\\s*/).filter(Boolean)\r\n      if (numbered.length > 1) return numbered.map(s => s.trim()).filter(Boolean)\r\n      // 退化：按换行/顿号/句号切\r\n      return m.split(/[\\n。]/).map(s => s.trim()).filter(Boolean)\r\n    },\r\n    isFavorited() {\r\n      const id = this.recipe.id\r\n      if (!id) return false\r\n      return (this.favorites || []).includes(String(id)) || (this.favorites || []).includes(Number(id))\r\n    },\r\n    isInPlan() {\r\n      const id = this.recipe.id\r\n      if (!id) return false\r\n      return (this.todayPlan || []).includes(String(id)) || (this.todayPlan || []).includes(Number(id))\r\n    },\r\n    timeLeft() {\r\n      const s = Math.max(0, this.timerSeconds || 0)\r\n      const mm = String(Math.floor(s / 60)).padStart(2, '0')\r\n      const ss = String(s % 60).padStart(2, '0')\r\n      return `${mm}:${ss}`\r\n    },\r\n    progressPct() {\r\n      const total = this.timerPreset || 0\r\n      if (!total || total <= 0) return 0\r\n      if (!this.timerStarted) return 0\r\n      const elapsed = Math.max(0, Math.min(total, total - (this.timerSeconds || 0)))\r\n      return Math.round((elapsed / total) * 100)\r\n    }\r\n  },\r\n  onLoad(options) {\r\n    // 接收路由参数，尽量兼容命名\r\n    const id = options?.id || options?.recipeId || options?.菜谱ID\r\n    const typeId = options?.typeId || options?.菜谱类型号\r\n    const name = options?.name || options?.菜谱名称\r\n    const method = options?.method || options?.做法\r\n    const condiments = options?.condiments || options?.调料\r\n    const ingredients = options?.ingredients || options?.原料\r\n    const feature = options?.feature || options?.特性\r\n    const imageUrl = options?.imageUrl || options?.图片URL\r\n\r\n    // 如果仅传了 id=952，则填充示例数据\r\n    if (id && String(id) === '952' && !name) {\r\n      this.recipe = {\r\n        id: 952,\r\n        typeId: typeId || 101,\r\n        name: '蛋花丝瓜汤',\r\n        method:\r\n          '(1)丝瓜洗净，去皮切片；香菜择洗干净切段。\\n(2)油锅烧热，放入葱花炝锅，下丝瓜煸炒，加适量清水、盐煮沸后，倒入蛋花液，加香菜、味精即成。',\r\n        condiments: '味精,盐,植物油',\r\n        ingredients: '蛋黄1个30克,丝瓜100克',\r\n        feature: feature || '',\r\n        imageUrl: imageUrl || ''\r\n      }\r\n    } else {\r\n      this.recipe = {\r\n        id: id || null,\r\n        typeId: typeId || null,\r\n        name: name || '',\r\n        method: method || '',\r\n        condiments: condiments || '',\r\n        ingredients: ingredients || '',\r\n        feature: feature || '',\r\n        imageUrl: imageUrl || ''\r\n      }\r\n    }\r\n\r\n    // 若缺字段，尝试用本地收藏卡片/随机列表补齐\r\n    this.hydrateById(this.recipe.id)\r\n\r\n    // 读取本地存储\r\n    try {\r\n      this.favorites = uni.getStorageSync('favorites_recipes') || []\r\n      this.todayPlan = uni.getStorageSync('today_plan_recipes') || []\r\n    } catch(e) {\r\n      this.favorites = []\r\n      this.todayPlan = []\r\n    }\r\n\r\n    // 初始化计时（允许通过 ?preset=600 指定）\r\n    const preset = parseInt(options?.preset || '', 10)\r\n    if (!isNaN(preset) && preset > 0) {\r\n      this.timerPreset = preset\r\n    }\r\n    this.timerSeconds = 0\r\n\r\n    // 加载四个随机菜谱选择列表\r\n    try {\r\n      const sel = uni.getStorageSync('random_selection_data') || []\r\n      if (Array.isArray(sel) && sel.length) {\r\n        this.selection = sel\r\n        // 当前索引：根据传入的 id 定位\r\n        const curId = this.recipe.id\r\n        const idx = sel.findIndex(x => String(x.id) === String(curId))\r\n        this.currentIndex = idx >= 0 ? idx : 0\r\n        // 统一当前展示为索引项（确保字段映射）\r\n        this.applySelection(this.currentIndex)\r\n      }\r\n    } catch(e) {}\r\n  },\r\n  methods: {\r\n    // 根据 id 从本地收藏/随机列表补齐详情字段\r\n    hydrateById(id) {\r\n      if (!id) return\r\n      const key = String(id)\r\n      try {\r\n        const cards = uni.getStorageSync('favorites_cards') || {}\r\n        const c = cards[key] || {}\r\n        // 收藏卡片：补齐名称与封面\r\n        if (!this.recipe.name && c.name) this.recipe.name = c.name\r\n        if (!this.recipe.imageUrl && c.imageUrl) this.recipe.imageUrl = c.imageUrl\r\n      } catch(e) {}\r\n\r\n      try {\r\n        const sel = uni.getStorageSync('random_selection_data') || []\r\n        if (Array.isArray(sel) && sel.length) {\r\n          const s = sel.find(x => String(x.id) === key) || {}\r\n          // 随机列表：尽量补齐更多字段\r\n          if (!this.recipe.typeId && s.typeId != null) this.recipe.typeId = s.typeId\r\n          if (!this.recipe.name && s.name) this.recipe.name = s.name\r\n          if (!this.recipe.method && s.method) this.recipe.method = s.method\r\n          if (!this.recipe.condiments && s.condiments) this.recipe.condiments = s.condiments\r\n          if (!this.recipe.ingredients && s.ingredients) this.recipe.ingredients = s.ingredients\r\n          if (!this.recipe.feature && s.feature) this.recipe.feature = s.feature\r\n          if (!this.recipe.imageUrl && (s.cover || s.imageUrl)) this.recipe.imageUrl = s.cover || s.imageUrl\r\n        }\r\n      } catch(e) {}\r\n    },\r\n    goBack() {\r\n      const pages = getCurrentPages && getCurrentPages()\r\n      if (pages && pages.length > 1) {\r\n        uni.navigateBack({ delta: 1 })\r\n      } else {\r\n        uni.switchTab ? uni.switchTab({ url: '/pages/index/index' }) : uni.reLaunch({ url: '/pages/index/index' })\r\n      }\r\n    },\r\n    cancelAndBack() {\r\n      const pages = getCurrentPages && getCurrentPages()\r\n      if (pages && pages.length > 1) {\r\n        uni.navigateBack({ delta: 1 })\r\n      } else {\r\n        uni.reLaunch({ url: '/pages/index/index' })\r\n      }\r\n    },\r\n    // 应用选择项到详情\r\n    applySelection(i) {\r\n      if (!Array.isArray(this.selection) || !this.selection.length) return\r\n      const n = ((i % this.selection.length) + this.selection.length) % this.selection.length\r\n      this.currentIndex = n\r\n      const s = this.selection[n] || {}\r\n      this.recipe = {\r\n        id: s.id || null,\r\n        typeId: s.typeId || null,\r\n        name: s.name || '',\r\n        method: s.method || '',\r\n        condiments: s.condiments || '',\r\n        ingredients: s.ingredients || '',\r\n        feature: s.feature || '',\r\n        imageUrl: s.cover || s.imageUrl || this.fallbackImg\r\n      }\r\n    },\r\n    // 上一个/下一个\r\n    prevSelection() {\r\n      if (!this.selection.length) return\r\n      this.applySelection(this.currentIndex - 1)\r\n    },\r\n    nextSelection() {\r\n      if (!this.selection.length) return\r\n      this.applySelection(this.currentIndex + 1)\r\n    },\r\n    // 收藏/计划本地存储\r\n    saveStorage() {\r\n      uni.setStorageSync('favorites_recipes', this.favorites || [])\r\n      uni.setStorageSync('today_plan_recipes', this.todayPlan || [])\r\n    },\r\n    toggleFavorite() {\r\n      const id = this.recipe.id\r\n      if (!id) return\r\n      const key = String(id)\r\n      const arr = (this.favorites || []).map(x => String(x))\r\n      const idx = arr.indexOf(key)\r\n\r\n      // 读取收藏时间元数据与名片\r\n      let meta = {}\r\n      let cards = {}\r\n      try {\r\n        meta = uni.getStorageSync('favorites_meta') || {}\r\n        cards = uni.getStorageSync('favorites_cards') || {}\r\n      } catch(e) {\r\n        meta = {}\r\n        cards = {}\r\n      }\r\n\r\n      if (idx >= 0) {\r\n        // 取消收藏\r\n        this.favorites.splice(idx, 1)\r\n        if (meta[key]) delete meta[key]\r\n        if (cards[key]) delete cards[key]\r\n        // 同时去掉计划日期\r\n        const planned = uni.getStorageSync('favorites_planned') || {}\r\n        if (planned[key]) {\r\n          delete planned[key]\r\n          uni.setStorageSync('favorites_planned', planned)\r\n        }\r\n        uni.setStorageSync('favorites_meta', meta)\r\n        uni.setStorageSync('favorites_cards', cards)\r\n        uni.showToast({ title: '已取消收藏', icon: 'none' })\r\n        this.saveStorage()\r\n      } else {\r\n        // 先选择日期，再加入收藏\r\n        this.planSelectDate(key)\r\n      }\r\n    },\r\n    togglePlan() {\r\n      const id = this.recipe.id\r\n      if (!id) return\r\n      const key = String(id)\r\n      const arr = (this.todayPlan || []).map(x => String(x))\r\n      const idx = arr.indexOf(key)\r\n      if (idx >= 0) {\r\n        this.todayPlan.splice(idx, 1)\r\n        uni.showToast({ title: '已移出计划', icon: 'none' })\r\n      } else {\r\n        this.todayPlan.push(key)\r\n        uni.showToast({ title: '已加入今日计划', icon: 'none' })\r\n      }\r\n      this.saveStorage()\r\n    },\r\n    // 计时器\r\n    selectPreset(sec) {\r\n      if (this.timerRunning) this.pauseTimer()\r\n      this.timerPreset = sec\r\n      this.timerSeconds = sec\r\n      this.timerStarted = false\r\n    },\r\n    startTimer() {\r\n      if (this.timerRunning) return\r\n      this.timerRunning = true\r\n      this.timerStarted = true\r\n      this.timerTick = setInterval(() => {\r\n        if (this.timerSeconds > 0) {\r\n          this.timerSeconds -= 1\r\n        } else {\r\n          this.pauseTimer()\r\n          uni.showToast({ title: '时间到！', icon: 'none' })\r\n        }\r\n      }, 1000)\r\n    },\r\n    pauseTimer() {\r\n      this.timerRunning = false\r\n      if (this.timerTick) {\r\n        clearInterval(this.timerTick)\r\n        this.timerTick = null\r\n      }\r\n    },\r\n    resetTimer() {\r\n      this.pauseTimer()\r\n      this.timerSeconds = 0\r\n      this.timerStarted = false\r\n    },\r\n    applyCustomPreset() {\r\n      const n = parseInt(this.customPresetMinutes, 10)\r\n      if (isNaN(n) || n <= 0) {\r\n        uni.showToast({ title: '请输入有效分钟数', icon: 'none' })\r\n        return\r\n      }\r\n      const sec = n * 60\r\n      this.selectPreset(sec)\r\n      this.customPresetVisible = false\r\n      uni.showToast({ title: `已设定${n}分钟`, icon: 'none' })\r\n    },\r\n    // 选择待做日期（未来7天，自定义弹层）\r\n    planSelectDate(key) {\r\n      const today = new Date()\r\n      const options = []\r\n      const isoDates = []\r\n      for (let i = 0; i < 7; i++) {\r\n        const d = new Date(today.getFullYear(), today.getMonth(), today.getDate() + i)\r\n        const y = d.getFullYear()\r\n        const m = String(d.getMonth() + 1).padStart(2, '0')\r\n        const day = String(d.getDate()).padStart(2, '0')\r\n        const iso = `${y}-${m}-${day}`\r\n        let label = `${m}月${day}日`\r\n        if (i === 0) label = `${m}月${day}日（今日）`\r\n        else if (i === 1) label = `${m}月${day}日（明日）`\r\n        else if (i === 2) label = `${m}月${day}日（后日）`\r\n        options.push(label)\r\n        isoDates.push(iso)\r\n      }\r\n      this._favKey = String(key)\r\n      this.dateOptions = options\r\n      this.dateIso = isoDates\r\n      this.datePickerVisible = true\r\n    },\r\n    // 选择某个日期\r\n    chooseDate(pick) {\r\n      const key = this._favKey\r\n      if (!key || pick == null) return\r\n      const dateStr = this.dateIso[pick]\r\n      // 写入收藏与名片\r\n      if (!this.favorites.map(String).includes(String(key))) {\r\n        this.favorites.push(String(key))\r\n      }\r\n      let cards = {}\r\n      try { cards = uni.getStorageSync('favorites_cards') || {} } catch(e) { cards = {} }\r\n      cards[key] = {\r\n        id: String(key),\r\n        name: this.recipe.name || '',\r\n        imageUrl: this.recipe.imageUrl || this.fallbackImg\r\n      }\r\n      uni.setStorageSync('favorites_cards', cards)\r\n      // 写入计划日期\r\n      let planned = {}\r\n      try { planned = uni.getStorageSync('favorites_planned') || {} } catch(e) { planned = {} }\r\n      planned[key] = dateStr\r\n      uni.setStorageSync('favorites_planned', planned)\r\n      this.saveStorage()\r\n      this.datePickerVisible = false\r\n      uni.showToast({ title: `已加入${dateStr}待做菜谱`, icon: 'none' })\r\n    },\r\n    // 关闭弹层\r\n    closeDatePicker() {\r\n      this.datePickerVisible = false\r\n      uni.showToast({ title: '已取消', icon: 'none' })\r\n    },\r\n    startCook() {\r\n      // 开始烹饪即启动计时\r\n      if (!this.timerRunning) {\r\n        this.startTimer()\r\n        uni.showToast({ title: '已开始烹饪～', icon: 'none' })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.detail-page {\r\n  background: #f7f2e7;\r\n  min-height: 100vh;\r\n}\r\n\r\n/* 顶部大图 */\r\n.hero {\r\n  position: relative;\r\n  height: 420rpx;\r\n  overflow: hidden;\r\n}\r\n.hero-img {\r\n  width: 100%;\r\n  height: 100%;\r\n  display: block;\r\n}\r\n.hero-mask {\r\n  position: absolute;\r\n  inset: 0;\r\n  background: linear-gradient(180deg, rgba(0,0,0,0.15) 0%, rgba(0,0,0,0.45) 100%);\r\n}\r\n.hero-title {\r\n  position: absolute;\r\n  left: 24rpx;\r\n  right: 24rpx;\r\n  bottom: 24rpx;\r\n  color: #fff;\r\n}\r\n.name {\r\n  font-size: 40rpx;\r\n  font-weight: 800;\r\n}\r\n.meta {\r\n  margin-top: 12rpx;\r\n  display: flex;\r\n  gap: 12rpx;\r\n}\r\n.tag {\r\n  padding: 8rpx 16rpx;\r\n  border-radius: 999rpx;\r\n  font-size: 22rpx;\r\n  background: rgba(255,255,255,0.2);\r\n  color: #fff;\r\n}\r\n.tag-orange { background: linear-gradient(90deg, #FFE27A, #FFC107); }\r\n.tag-green { background: #27ae60; }\r\n.tag-blue { background: #3b82f6; }\r\n\r\n/* 顶部收藏星标 */\r\n.fav-btn {\r\n  position: absolute;\r\n  right: 20rpx;\r\n  top: 20rpx;\r\n  width: 64rpx;\r\n  height: 64rpx;\r\n  border-radius: 32rpx;\r\n  background: rgba(255,255,255,0.22);\r\n  backdrop-filter: blur(4rpx);\r\n  box-shadow: 0 8rpx 20rpx rgba(0,0,0,0.18);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n.star {\r\n  font-size: 40rpx;\r\n  line-height: 1;\r\n  color: #ffd700; /* 金色星标 */\r\n}\r\n.fav-btn:active { transform: scale(0.96); }\r\n\r\n/* 云朵元素样式已移除 */\r\n\r\n/* 卡片通用 */\r\n.card {\r\n  margin: 12rpx 24rpx 16rpx; /* 下移避免与顶部图片重叠 */\r\n  background: #fff;\r\n  border-radius: 24rpx;\r\n  box-shadow: 0 16rpx 36rpx rgba(0,0,0,0.08);\r\n  overflow: hidden;\r\n}\r\n.card-title {\r\n  padding: 22rpx 24rpx 0;\r\n  font-size: 28rpx;\r\n  font-weight: 700;\r\n  color: #1f2937;\r\n}\r\n.card-body {\r\n  padding: 16rpx 24rpx 24rpx;\r\n}\r\n.para {\r\n  font-size: 26rpx;\r\n  color: #4b5563;\r\n  line-height: 1.7;\r\n}\r\n\r\n/* 步骤列表 */\r\n.steps {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 14rpx;\r\n}\r\n.step-item {\r\n  display: flex;\r\n  align-items: flex-start;\r\n  gap: 12rpx;\r\n}\r\n.step-index {\r\n  width: 40rpx;\r\n  height: 40rpx;\r\n  border-radius: 20rpx;\r\n  text-align: center;\r\n  line-height: 40rpx;\r\n  font-size: 24rpx;\r\n  font-weight: 700;\r\n  background: linear-gradient(90deg, #FFE27A 0%, #FFC107 100%);\r\n  color: #fff;\r\n  box-shadow: 0 6rpx 16rpx rgba(255,122,0,0.3);\r\n}\r\n.step-text {\r\n  flex: 1;\r\n  font-size: 26rpx;\r\n  color: #374151;\r\n}\r\n\r\n/* 底部操作条 */\r\n.bottom-bar {\r\n  position: fixed;\r\n  left: 0; right: 0; bottom: 0;\r\n  padding: 12rpx 20rpx 22rpx;\r\n  background: rgba(255,255,255,0.9);\r\n  backdrop-filter: blur(6rpx);\r\n  display: flex;\r\n  gap: 16rpx;\r\n}\r\n.btn {\r\n  flex: 1 1 0;\r\n  height: 88rpx;\r\n  line-height: 88rpx;\r\n  text-align: center;\r\n  border-radius: 16rpx;\r\n  font-size: 28rpx;\r\n}\r\n.btn.ghost {\r\n  background: #f3f4f6;\r\n  color: #374151;\r\n}\r\n.btn.primary {\r\n  background: linear-gradient(90deg, #FFE27A 0%, #FFC107 100%);\r\n  color: #fff;\r\n  box-shadow: 0 8rpx 22rpx rgba(255,193,7,0.32);\r\n}\r\n\r\n/* 计时UI */\r\n.timer-card .timer-row {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n}\r\n.time-left {\r\n  font-size: 40rpx;\r\n  font-weight: 800;\r\n  color: #111827;\r\n}\r\n.preset-group {\r\n  display: flex;\r\n  gap: 12rpx;\r\n}\r\n.chip-btn {\r\n  padding: 10rpx 18rpx;\r\n  border-radius: 999rpx;\r\n  font-size: 24rpx;\r\n  background: #f3f4f6;\r\n  color: #374151;\r\n}\r\n.chip-btn.active {\r\n  color: #fff;\r\n  background: linear-gradient(90deg, #FFE27A 0%, #FFC107 100%);\r\n  box-shadow: 0 6rpx 14rpx rgba(255,193,7,0.28);\r\n}\r\n/* 自定义计时样式 */\r\n.custom-row {\r\n  margin-top: 12rpx;\r\n  display: flex;\r\n  gap: 12rpx;\r\n  align-items: center;\r\n}\r\n.custom-input {\r\n  flex: 1;\r\n  height: 64rpx;\r\n  background: #fff;\r\n  border-radius: 12rpx;\r\n  padding: 0 16rpx;\r\n  font-size: 26rpx;\r\n  box-shadow: 0 6rpx 14rpx rgba(0,0,0,0.06);\r\n}\r\n.set-btn {\r\n  padding: 10rpx 18rpx;\r\n}\r\n.progress {\r\n  margin-top: 16rpx;\r\n  height: 12rpx;\r\n  background: #e5e7eb;\r\n  border-radius: 999rpx;\r\n  overflow: hidden;\r\n}\r\n.progress .bar {\r\n  height: 100%;\r\n  background: transparent;\r\n  width: 0%;\r\n}\r\n.timer-actions {\r\n  margin-top: 16rpx;\r\n  display: flex;\r\n  gap: 16rpx;\r\n}\r\n.btn.small {\r\n  height: 72rpx;\r\n  line-height: 72rpx;\r\n  font-size: 26rpx;\r\n}\r\n/* 选择条样式 */\r\n.selection-strip {\r\n  margin: 12rpx 24rpx;\r\n  display: flex;\r\n  white-space: nowrap;\r\n}\r\n.sel-item {\r\n  display: inline-flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  width: 200rpx;\r\n  margin-right: 16rpx;\r\n  background: #fff;\r\n  border-radius: 16rpx;\r\n  box-shadow: 0 10rpx 24rpx rgba(0,0,0,0.06);\r\n  overflow: hidden;\r\n  border: 2rpx solid transparent;\r\n}\r\n.sel-item.active {\r\n  border-color: #ff8a34;\r\n}\r\n.sel-cover {\r\n  width: 200rpx;\r\n  height: 140rpx;\r\n  background: #eee;\r\n}\r\n.sel-name {\r\n  padding: 10rpx 12rpx 14rpx;\r\n  font-size: 24rpx;\r\n  color: #1f2937;\r\n  max-width: 100%;\r\n  text-align: center;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n}\r\n/* 合并大卡片分区样式（与随机页一致） */\r\n.big-card .section + .section {\r\n  border-top: 1rpx solid #f1f5f9;\r\n  margin-top: 8rpx;\r\n  padding-top: 8rpx;\r\n}\r\n.section-body { padding-top: 10rpx; }\r\n\r\n/* 基本信息样式 */\r\n.info-list {\r\n  padding-top: 6rpx;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 10rpx;\r\n}\r\n.info-item {\r\n  display: flex;\r\n  align-items: flex-start;\r\n  gap: 8rpx;\r\n  line-height: 1.6;\r\n}\r\n.info-label {\r\n  color: #6b7280;\r\n  font-size: 26rpx;\r\n}\r\n.info-value {\r\n  color: #1f2937;\r\n  font-size: 26rpx;\r\n  flex: 1;\r\n}\r\n\r\n/* 自定义日期弹层样式 */\r\n.overlay {\r\n  position: fixed;\r\n  inset: 0;\r\n  background: rgba(0,0,0,0.35);\r\n  display: flex;\r\n  align-items: flex-end;\r\n  justify-content: center;\r\n  z-index: 9999;\r\n}\r\n.sheet {\r\n  width: 100%;\r\n  background: #fff;\r\n  border-top-left-radius: 20rpx;\r\n  border-top-right-radius: 20rpx;\r\n  padding: 16rpx 16rpx 24rpx;\r\n}\r\n.sheet-title {\r\n  text-align: center;\r\n  font-size: 28rpx;\r\n  font-weight: 700;\r\n  color: #111827;\r\n  padding: 8rpx 0 12rpx;\r\n}\r\n.sheet-list {\r\n  max-height: 420rpx;\r\n}\r\n.sheet-item {\r\n  padding: 22rpx 16rpx;\r\n  border-bottom: 1rpx solid #f3f4f6;\r\n  font-size: 28rpx;\r\n  color: #111827;\r\n}\r\n.sheet-item:last-child {\r\n  border-bottom: 0;\r\n}\r\n\r\n</style>","import mod from \"-!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./detail.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./detail.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1761642868854\n      var cssReload = require(\"C:/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}