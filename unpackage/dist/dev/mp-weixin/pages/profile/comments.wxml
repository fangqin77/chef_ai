<view class="page"><view class="header"><text class="title">我的评论</text></view><block wx:if="{{!$root.g0}}"><view class="empty"><text class="tip">暂无评论记录</text><button data-event-opts="{{[['tap',[['goSocial',['$event']]]]]}}" class="btn primary small" bindtap="__e">去美食圈</button></view></block><block wx:else><scroll-view class="list" scroll-y="{{true}}"><block wx:for="{{$root.l1}}" wx:for-item="comment" wx:for-index="__i0__" wx:key="id"><view class="card"><view class="top"><image class="avatar" src="{{currentUserAvatar||fallbackImg}}" mode="aspectFill"></image><view class="meta"><text class="name">{{currentUserName||'我'}}</text><text class="time">{{comment.m0}}</text></view><view class="ops"><button data-event-opts="{{[['tap',[['editComment',['$0'],[[['comments','id',comment.$orig.id]]]]]]]}}" class="btn tiny primary" bindtap="__e">编辑</button><button data-event-opts="{{[['tap',[['deleteComment',['$0'],[[['comments','id',comment.$orig.id]]]]]]]}}" class="btn tiny ghost" bindtap="__e">删除</button><button data-event-opts="{{[['tap',[['open',['$0'],[[['comments','id',comment.$orig.id]]]]]]]}}" class="btn tiny ghost" bindtap="__e">查看帖子</button></view></view><block wx:if="{{!comment.$orig.editing}}"><view class="content">{{comment.$orig.content}}</view></block><block wx:if="{{comment.$orig.editing}}"><view class="edit-mode"><textarea class="edit-textarea" placeholder="{{comment.$orig.content}}" maxlength="500" auto-height="{{true}}" data-event-opts="{{[['input',[['__set_model',['$0','editContent','$event',[]],[[['comments','id',comment.$orig.id]]]]]]]}}" value="{{comment.$orig.editContent}}" bindinput="__e"></textarea><view class="edit-actions"><button data-event-opts="{{[['tap',[['cancelEdit',['$0'],[[['comments','id',comment.$orig.id]]]]]]]}}" class="btn tiny ghost" bindtap="__e">取消</button><button data-event-opts="{{[['tap',[['saveEdit',['$0'],[[['comments','id',comment.$orig.id]]]]]]]}}" class="btn tiny primary" bindtap="__e">保存</button></view></view></block><block wx:if="{{comment.$orig.showPostDetail}}"><view class="post-detail"><view class="post-header"><text class="post-detail-title">帖子详情</text><button data-event-opts="{{[['tap',[['closePostDetail',['$0'],[[['comments','id',comment.$orig.id]]]]]]]}}" class="close-btn" bindtap="__e">取消</button></view><view class="post-content"><text class="post-text">{{comment.$orig.postDetail&&comment.$orig.postDetail.content||'暂无内容'}}</text><block wx:if="{{comment.$orig.postDetail&&comment.$orig.postDetail.mediaJson}}"><view class="post-images"><block wx:for="{{comment.l0}}" wx:for-item="img" wx:for-index="index" wx:key="index"><image class="post-image" src="{{img}}" mode="aspectFill" data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" data-event-params="{{({comment:comment.$orig,index})}}" bindtap="__e"></image></block><block wx:if="{{comment.g1>3}}"><view class="more-images"><text class="more-text">{{"+"+(comment.g2-3)+"张"}}</text></view></block></view></block></view><view class="post-footer"><text class="post-time">{{comment.m1}}</text></view></view></block></view></block></scroll-view></block><block wx:if="{{showDeleteModal}}"><view class="modal"><view class="modal-content"><text class="modal-title">确认删除</text><text class="modal-text">确定要删除这条评论吗？</text><view class="modal-actions"><button data-event-opts="{{[['tap',[['e1',['$event']]]]]}}" class="btn ghost" bindtap="__e">取消</button><button data-event-opts="{{[['tap',[['confirmDelete',['$event']]]]]}}" class="btn primary" bindtap="__e">确认删除</button></view></view></view></block></view>