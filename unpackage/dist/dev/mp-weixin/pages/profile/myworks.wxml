<view class="page"><block wx:if="{{!$root.g0}}"><view class="empty"><text class="tip">还没有发布作品</text><button data-event-opts="{{[['tap',[['goPublish',['$event']]]]]}}" class="btn primary small" bindtap="__e">去发布</button></view></block><block wx:else><scroll-view class="list" scroll-y="{{true}}" refresher-enabled="true" refresher-background="#f7f2e7" data-event-opts="{{[['refresherrefresh',[['onRefresh',['$event']]]],['scrolltolower',[['loadMore',['$event']]]]]}}" bindrefresherrefresh="__e" bindscrolltolower="__e"><block wx:for="{{$root.l0}}" wx:for-item="p" wx:for-index="__i0__" wx:key="id"><view class="card"><block wx:if="{{!p.$orig._editing}}"><view class="post-item"><view class="post-header"><view class="post-image-section"><image class="post-image" src="{{p.m0}}" mode="aspectFill"></image><block wx:if="{{p.m1>1}}"><view class="image-count-badge"><text class="count-text">{{p.m2+"图"}}</text></view></block></view><view class="post-content-section"><text class="post-content">{{p.$orig.content||p.$orig.text||'美食作品'}}</text><text class="post-time">{{p.m3}}</text></view><view class="post-actions"><button data-event-opts="{{[['tap',[['editPost',['$0'],[[['posts','id',p.$orig.id]]]]]]]}}" class="btn tiny ghost" bindtap="__e">编辑</button><button data-event-opts="{{[['tap',[['deletePost',['$0'],[[['posts','id',p.$orig.id]]]]]]]}}" class="btn tiny danger" bindtap="__e">删除</button></view></view></view></block><block wx:else><view class="edit-panel"><view class="edit-image-section"><text class="label">图片</text><view class="images-preview"><view class="image-list"><block wx:for="{{p.$orig._editForm.images||p.$orig.images||[]}}" wx:for-item="img" wx:for-index="index" wx:key="index"><view class="image-item"><image class="preview-image" src="{{img||fallbackImg}}" mode="aspectFill"></image><view data-event-opts="{{[['tap',[['removeImage',['$0',index],[[['posts','id',p.$orig.id]]]]]]]}}" class="remove-btn" bindtap="__e"><text class="remove-icon">×</text></view></view></block><block wx:if="{{p.g1<9}}"><view data-event-opts="{{[['tap',[['changeImage',['$0'],[[['posts','id',p.$orig.id]]]]]]]}}" class="add-image-btn" bindtap="__e"><text class="add-icon">+</text><text class="add-text">添加图片</text></view></block></view><text class="image-count">{{"已选择 "+p.g2+"/9 张图片"}}</text></view></view><view class="row"><text class="label">文案</text><textarea class="textarea" placeholder="编辑你的文案" maxlength="200" data-event-opts="{{[['input',[['__set_model',['$0','text','$event',[]],[[['posts','id',p.$orig.id,'_editForm']]]]]]]}}" value="{{p.$orig._editForm.text}}" bindinput="__e"></textarea></view><view class="edit-ops"><button data-event-opts="{{[['tap',[['saveEdit',['$0'],[[['posts','id',p.$orig.id]]]]]]]}}" class="btn tiny primary" bindtap="__e">保存</button><button data-event-opts="{{[['tap',[['cancelEdit',['$0'],[[['posts','id',p.$orig.id]]]]]]]}}" class="btn tiny ghost" bindtap="__e">取消</button></view><text class="hint">文字限制 200 字</text></view></block></view></block></scroll-view></block></view>