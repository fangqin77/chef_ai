<view class="chat-page"><scroll-view class="messages" scroll-y="{{true}}" scroll-top="{{scrollTop}}" scroll-with-animation="{{true}}" refresher-enabled="{{false}}" data-event-opts="{{[['scrolltoupper',[['loadMore',['$event']]]]]}}" bindscrolltoupper="__e"><block wx:for="{{messages}}" wx:for-item="msg" wx:for-index="index" wx:key="index"><view class="{{['msg',msg.type]}}"><block wx:if="{{msg.type==='assistant'}}"><image class="avatar" src="{{assistantAvatar}}" mode="aspectFit"></image></block><block wx:else><view class="avatar-placeholder"></view></block><view class="bubble">{{''+msg.content+''}}<block wx:if="{{msg.loading}}"><view class="typing-dots"><view class="dot"></view><view class="dot"></view><view class="dot"></view></view></block></view></view></block></scroll-view><view class="input-bar"><input class="input-field" placeholder="输入食材/偏好" disabled="{{isLoading}}" confirm-type="send" data-event-opts="{{[['confirm',[['sendMessage',['$event']]]],['input',[['__set_model',['','userInput','$event',[]]]]]]}}" value="{{userInput}}" bindconfirm="__e" bindinput="__e"/><button class="send-btn" disabled="{{$root.g0}}" data-event-opts="{{[['tap',[['sendMessage',['$event']]]]]}}" bindtap="__e">{{''+(isLoading?'发送中...':'发送')+''}}</button></view></view>