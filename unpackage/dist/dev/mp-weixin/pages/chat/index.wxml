<view class="chat-page"><scroll-view class="messages" scroll-y="{{true}}" scroll-top="{{scrollTop}}" scroll-with-animation="{{true}}" refresher-enabled="{{false}}" data-event-opts="{{[['scrolltoupper',[['loadMore',['$event']]]]]}}" bindscrolltoupper="__e"><block wx:for="{{messages}}" wx:for-item="msg" wx:for-index="index" wx:key="index"><view class="{{['msg',msg.type]}}"><block wx:if="{{msg.type==='assistant'}}"><image class="avatar" src="{{assistantAvatar}}" mode="aspectFit"></image></block><block wx:else><view class="avatar-placeholder"></view></block><view class="bubble"><block wx:if="{{msg.isRecipe}}"><view class="recipe-card"><view class="recipe-header"><text class="recipe-icon">ğŸ½ï¸</text><text class="recipe-title">{{msg.recipe.name}}</text></view><block wx:if="{{msg.recipe.basicInfo}}"><view class="recipe-section"><view class="section-title"><text class="section-icon">ğŸ“‹</text><text class="section-text">åŸºæœ¬ä¿¡æ¯</text></view><view class="info-grid"><block wx:for="{{msg.recipe.basicInfo}}" wx:for-item="info" wx:for-index="key" wx:key="key"><view class="info-item"><text class="info-label">{{info.label+"ï¼š"}}</text><text class="info-value">{{info.value}}</text></view></block></view></view></block><block wx:if="{{msg.recipe.method}}"><view class="recipe-section"><view class="section-title"><text class="section-icon">ğŸ‘¨â€ğŸ³</text><text class="section-text">åˆ¶ä½œæ–¹æ³•</text></view><view class="steps"><block wx:for="{{msg.recipe.method}}" wx:for-item="step" wx:for-index="index" wx:key="index"><view class="step"><text class="step-number">{{index+1}}</text><text class="step-text">{{step}}</text></view></block></view></view></block><block wx:if="{{msg.recipe.nutrition}}"><view class="recipe-section"><view class="section-title"><text class="section-icon">ğŸ“Š</text><text class="section-text">è¥å…»æˆåˆ†</text></view><view class="nutrition-grid"><block wx:for="{{msg.recipe.nutrition}}" wx:for-item="nutri" wx:for-index="key" wx:key="key"><view class="nutrition-item"><text class="nutrition-label">{{nutri.label}}</text><text class="nutrition-value">{{nutri.value}}</text></view></block></view></view></block><block wx:if="{{msg.recipe.tips}}"><view class="recipe-section"><view class="section-title"><text class="section-icon">ğŸ’¡</text><text class="section-text">é£Ÿç”¨å»ºè®®</text></view><text class="tips-text">{{msg.recipe.tips}}</text></view></block></view></block><block wx:else>{{''+msg.content+''}}</block><block wx:if="{{msg.loading}}"><view class="typing-dots"><view class="dot"></view><view class="dot"></view><view class="dot"></view></view></block></view></view></block></scroll-view><view class="input-bar"><input class="input-field" placeholder="è¾“å…¥é£Ÿæ/åå¥½" disabled="{{isLoading}}" confirm-type="send" data-event-opts="{{[['confirm',[['sendMessage',['$event']]]],['input',[['__set_model',['','userInput','$event',[]]]]]]}}" value="{{userInput}}" bindconfirm="__e" bindinput="__e"/><button class="send-btn" disabled="{{$root.g0}}" data-event-opts="{{[['tap',[['sendMessage',['$event']]]]]}}" bindtap="__e">{{''+(isLoading?'å‘é€ä¸­...':'å‘é€')+''}}</button></view></view>